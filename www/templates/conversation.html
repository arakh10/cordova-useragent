<ion-view>
    <ion-nav-title>
        <i ng-if="conversation.withUser.isOnline" class="online"></i>
        {{conversation.withUser.nickName}}
    </ion-nav-title>

    <ion-nav-buttons side="right">
        <!--<button class="button button-stable" ng-if="conversation.withUser" ng-click="report()"><i class="icon ion-alert-circled"></i></button>-->
        <a href="#/users/{{conversation.withUser.id}}" ng-if="conversation.withUser">
            <img class="avatar" ng-src="{{conversation.withUser.profilePhoto | profilePhotoUrl:conversation.withUser.gender}}" />
        </a>
    </ion-nav-buttons>

    <ion-content>

        <ul class="list chat">
            <li
                class="message"
                ng-repeat="message in messages"
                ng-class="{'item-positive': message.isNew, mine: message.id == currUser.id, failed: message.error ? true : false}"
                ng-click="resend($index)">

                <span ng-bind-html="message.text | linky | emoticonize" parse-urls></span>

                <div class="attachment" ng-if="message.attachment" ng-switch="message.type">
                    <a ng-switch-when="image" ng-href="{{message.attachment.url}}" parse-urls>
                        <img ng-src="{{message.attachment.thumbUrl}}" />
                    </a>
                </div>

                <div class="status">
                    <span ng-if="message.error" translate>Failed. Tap to retry.</span>
                    <span ng-if="!message.error">
                        <span ng-if="!message.dateSent" translate>Sending..</span>
                        <span ng-if="message.dateSent">{{message.dateSent*1000 | amCalendar}}</span>
                    </span>
                </div>
            </li>
        </ul>

        <div class="center center-vertical-margin">
            <ion-spinner ng-show="!messages.$resolved"></ion-spinner>
            <div class="error-sign" ng-if="messages.$resolved && messages.length < 1">
                <div translate>None yet</div>
                <span translate>Send a message. Get to know each other</span>
                <i class="icon ion-ios-rainy"></i>
            </div>
        </div>

    </ion-content>

    <ion-footer-bar keyboard-attach class="bar-stable">
        <form class="item-input-inset" ng-submit="sendMessage()" style="width: 100%">
            <label class="item-input-wrapper">
                <input
                        type="text"
                        placeholder="{{'Your message' | translate}}"
                        ng-model="msgText" />
            </label>
            <button class="button button-clear" type="submit" ng-disabled="msgText.length < 1" translate>
                Send
            </button>
        </form>
    </ion-footer-bar>
</ion-view>